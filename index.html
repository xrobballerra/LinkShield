<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>LinkShield | WORKING</title>
    <style>
        body { background: #0f0f0f; color: #eee; font-family: sans-serif; padding: 40px; text-align: center; }
        .card { background: #1a1a1a; border: 1px solid #333; padding: 25px; border-radius: 15px; max-width: 400px; margin: 0 auto 20px; }
        input { width: 100%; padding: 12px; margin: 10px 0; background: #000; border: 1px solid #444; color: #fff; border-radius: 5px; box-sizing: border-box; }
        button { width: 100%; padding: 12px; background: #FFD700; border: none; font-weight: bold; cursor: pointer; border-radius: 5px; }
        button:disabled { background: #444; color: #888; }
        #result { margin-top: 20px; padding: 15px; background: #000; border: 1px solid #4ade80; display: none; word-break: break-all; }
        .reset { color: #555; font-size: 11px; cursor: pointer; margin-top: 20px; display: block; }
    </style>
</head>
<body>

    <h1>ðŸŽ¬ LinkShield</h1>

    <div class="card" id="authBox">
        <button id="pairBtn" onclick="startPairing()">1. Link Real-Debrid</button>
        <div id="codeDisplay" style="display:none; margin-top:15px;">
            <div id="userCode" style="font-size:30px; color:#FFD700; font-weight:bold;">----</div>
            <p id="instr" style="font-size:12px; color:#888;"></p>
        </div>
    </div>

    <div class="card">
        <label>2. Paste Link</label>
        <input type="text" id="manualLink" placeholder="Paste hoster link here...">
        <button id="unrestrictBtn" disabled onclick="handleUnrestrict()">Bypass Restriction</button>
        <div id="result">
            <p style="color:#4ade80; margin-top:0;">âœ… Success!</p>
            <div id="finalUrl" style="font-family:monospace; font-size:12px; margin-bottom:10px;"></div>
            <button style="background:#4ade80" id="goBtn">Download Now</button>
        </div>
    </div>

    <span class="reset" onclick="localStorage.clear(); location.reload();">Reset Everything</span>

<script>
    const PROXY = 'https://linkshield-proxy.vercel.app/api/proxy?url=';
    const CLIENT_ID = 'X245A4XAIBGVM';

    async function startPairing() {
        const btn = document.getElementById('pairBtn');
        btn.textContent = "Connecting...";
        try {
            const res = await fetch(`${PROXY}${encodeURIComponent('https://api.real-debrid.com/oauth/v2/device/code?client_id=' + CLIENT_ID)}`);
            const data = await res.json();
            document.getElementById('codeDisplay').style.display = 'block';
            document.getElementById('userCode').textContent = data.user_code;
            document.getElementById('instr').innerHTML = `Go to <b>real-debrid.com/device</b>`;

            const poller = setInterval(async () => {
                const check = await fetch(`${PROXY}${encodeURIComponent(`https://api.real-debrid.com/oauth/v2/device/credentials?client_id=${CLIENT_ID}&code=${data.device_code}`)}`);
                if (check.status === 200) {
                    const creds = await check.json();
                    clearInterval(poller);
                    localStorage.setItem('rd_creds', JSON.stringify({id: creds.client_id, secret: creds.client_secret, code: data.device_code}));
                    location.reload();
                }
            }, 5000);
        } catch(e) { alert("Proxy error. Check URL."); }
    }

    async function handleUnrestrict() {
        const link = document.getElementById('manualLink').value.trim();
        const auth = JSON.parse(localStorage.getItem('rd_creds'));
        const btn = document.getElementById('unrestrictBtn');
        if(!link) return;

        btn.disabled = true; btn.textContent = "Processing...";

        try {
            // STEP 1: Get Token
            const tBody = `client_id=${auth.id}&client_secret=${auth.secret}&code=${auth.code}&grant_type=http://oauth.net/grant_type/device/1.0`;
            const tRes = await fetch(`${PROXY}${encodeURIComponent('https://api.real-debrid.com/oauth/v2/token')}`, {
                method: 'POST',
                body: tBody
            });
            const tData = await tRes.json();

            // STEP 2: Unrestrict
            const unRes = await fetch(`${PROXY}${encodeURIComponent('https://api.real-debrid.com/rest/1.0/unrestrict/link')}`, {
                method: 'POST',
                headers: { 'Authorization': `Bearer ${tData.access_token}` },
                body: `link=${encodeURIComponent(link)}`
            });
            const data = await unRes.json();

            if(data.download) {
                document.getElementById('result').style.display = 'block';
                document.getElementById('finalUrl').textContent = data.download;
                document.getElementById('goBtn').onclick = () => window.open(data.download, '_blank');
            } else { alert("RD Error: " + (data.error || "Check link")); }
        } catch(e) { alert("Request failed."); }
        finally { btn.disabled = false; btn.textContent = "Bypass Restriction"; }
    }

    window.onload = () => {
        if(localStorage.getItem('rd_creds')) {
            document.getElementById('unrestrictBtn').disabled = false;
            document.getElementById('pairBtn').textContent = "Account Linked âœ…";
            document.getElementById('pairBtn').disabled = true;
        }
    }
</script>
</body>
</html>
